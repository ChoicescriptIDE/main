window.alreadyLoaded = !0;

var scope = (window.opener ? window.opener.parent : parent).window, thisProject = scope.cside.getActiveProject();

nav = new SceneNavigator([ "startup" ]), stats = {}, isHeadless = !0;

var cside = {
    project: {},
    platform: null,
    popout: {
        is: window.opener,
        window: null
    },
    server: null,
    parent: () => {}
};

function printImage(source, alignment, alt, invert) {
    var img = document.createElement("img");
    "web-dropbox" === scope.cside.getPlatform() ? scope.cside.getDropboxImageUrl(thisProject.getPath() + source, function(err, path) {
        if (err) throw img.src = thisProject.getPath() + source, new Error(err.message);
        img.src = path;
    }) : img.src = source.match("data:image") ? source : cside.server + source, null !== alt && 0 < String(alt).length && img.setAttribute("alt", alt), 
    invert ? setClass(img, "invert align" + alignment) : setClass(img, "align" + alignment), 
    document.getElementById("text").appendChild(img);
}

function printLink(target, href, anchorText, onclick) {
    target = target || document.getElementById("text");
    var link = document.createElement("a");
    link.setAttribute("href", href), link.setAttribute("target", "_blank"), link.appendChild(document.createTextNode(anchorText)), 
    onclick && (link.addEventListener ? link.addEventListener("click", onclick, !0) : link.onclick = onclick), 
    target.appendChild(link), target.appendChild(document.createTextNode(" "));
}

function popOutWindow() {
    cside.popout.window ? cside.popout.window.focus() : cside.popout.window = window.open("run_index.html?persistence=CSIDE", cside.project.name, "height=500,width=500,scrollbars=1");
}

Scene.prototype.lineMsg = function() {
    return "line " + (this.lineNum + 1) + " of " + stats.sceneName + ": ";
}, window.addEventListener("message", event => {
    "startGame" === event.data.type && (window.allScenes = event.data.allScenes, cside.project = event.data.project, 
    cside.server = event.data.server, window.CSIDEPlatform = event.data.platform, event.data.allowScript || (Scene.prototype.script = function(code) {
        throw new Error("*script usage is disabled.");
    }), window.alreadyLoaded = !1, window.onload(), cside.parent = event.source);
}, !1), cside.popout.is && (window.allScenes = window.opener.allScenes), window.onerror = function(msg, file, line, stack) {
    var e = {};
    (e.message = msg) && (/file/i.test(msg) && /exist/i.test(msg) ? cside.parent.postMessage({
        type: "logIssue",
        project: cside.project,
        error: e
    }) : (e.message.match(/line [0-9]+/) ? e.lineNumber = parseInt(e.message.match(/line ([0-9]+)/)[1]) : e.lineNumber = "undefined", 
    cside.parent.postMessage({
        type: "logIssue",
        error: e,
        project: cside.project,
        file: {
            name: stats.sceneName
        }
    })));
}, Scene.prototype.sound = function(source) {
    source = cside.server + source, "function" == typeof playSound && playSound(source), 
    this.verifyImage && this.verifyImage(source);
}, "web-dropbox" != cside.platform && setTimeout(function() {
    window.$("body").on("click", "a", function(e) {
        return e.preventDefault(), $(this).hasClass("alertify-button") || cside.parent.postMessage({
            type: "handleLink",
            url: this.href
        }), !1;
    });
}, 1e3), $(document).ready(function() {
    cside.popout.is;
});